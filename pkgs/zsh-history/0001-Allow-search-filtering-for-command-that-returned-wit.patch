From 07f08ef309845878477d68f362a5e841de28ab49 Mon Sep 17 00:00:00 2001
From: Christian Kampka <christian@kampka.net>
Date: Fri, 30 Nov 2018 14:40:45 +0100
Subject: [PATCH 1/2] Allow search filtering for command that returned with an
 OK status code

---
 cli/screen.go    | 3 +++
 cmd/search.go    | 4 ++++
 config/config.go | 3 +++
 3 files changed, 10 insertions(+)

diff --git a/cli/screen.go b/cli/screen.go
index 1120589..3f4ac7c 100644
--- a/cli/screen.go
+++ b/cli/screen.go
@@ -62,6 +62,9 @@ func NewScreen() (s *Screen, err error) {
 		if cc.FilterHostname && cv.Hostname != record.Hostname {
 			continue
 		}
+		if cc.FilterStatus && cv.Status && record.Status != 0 {
+			continue
+		}
 		lines = append(lines, record.Render())
 		records = append(records, record)
 	}
diff --git a/cmd/search.go b/cmd/search.go
index bc094b2..96fee62 100644
--- a/cmd/search.go
+++ b/cmd/search.go
@@ -25,6 +25,9 @@ func search(cmd *cobra.Command, args []string) error {
 	if config.Conf.Screen.FilterHostname {
 		config.Conf.Var.Hostname = cli.GetHostName()
 	}
+	if config.Conf.Screen.FilterStatus {
+		config.Conf.Var.Status = true
+	}
 
 	screen, err := cli.NewScreen()
 	if err != nil {
@@ -50,6 +53,7 @@ func init() {
 	searchCmd.Flags().BoolVarP(&config.Conf.Screen.FilterDir, "filter-dir", "d", config.Conf.Screen.FilterDir, "Search with dir")
 	searchCmd.Flags().BoolVarP(&config.Conf.Screen.FilterBranch, "filter-branch", "b", config.Conf.Screen.FilterBranch, "Search with branch")
 	searchCmd.Flags().BoolVarP(&config.Conf.Screen.FilterHostname, "filter-hostname", "p", config.Conf.Screen.FilterHostname, "Search with hostname")
+	searchCmd.Flags().BoolVarP(&config.Conf.Screen.FilterStatus, "filter-status", "s", config.Conf.Screen.FilterStatus, "Search with status OK")
 	searchCmd.Flags().StringVarP(&config.Conf.Var.Query, "query", "q", config.Conf.Var.Query, "Search with query")
 	searchCmd.Flags().StringVarP(&config.Conf.Var.Columns, "columns", "c", config.Conf.Var.Columns, "Specify columns with options")
 }
diff --git a/config/config.go b/config/config.go
index 6fcd017..69a10c5 100644
--- a/config/config.go
+++ b/config/config.go
@@ -90,6 +90,7 @@ type ScreenConfig struct {
 	FilterDir      bool     `toml:"filter_dir"`
 	FilterBranch   bool     `toml:"filter_branch"`
 	FilterHostname bool     `toml:"filter_hostname"`
+	FilterStatus   bool     `toml:"filter_status"`
 	Columns        []string `toml:"columns"`
 	StatusOK       string   `toml:"status_ok"`
 	StatusNG       string   `toml:"status_ng"`
@@ -99,6 +100,7 @@ type VarConfig struct {
 	Dir      string
 	Branch   string
 	Hostname string
+	Status 	 bool
 	Query    string
 	Columns  string
 }
@@ -178,6 +180,7 @@ func (cfg *Config) LoadFile(file string) error {
 	cfg.Screen.FilterDir = false
 	cfg.Screen.FilterBranch = false
 	cfg.Screen.FilterHostname = false
+	cfg.Screen.FilterStatus = false
 	cfg.Screen.Columns = []string{"{{.Time}}", "{{.Status}}", "{{.Command}}"}
 	cfg.Screen.StatusOK = " "
 	cfg.Screen.StatusNG = "x"
-- 
2.18.1

